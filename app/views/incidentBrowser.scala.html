@(incidents: List[IncidentM], numberOfIncidents: Long, err: Option[String], params: BrowserParams)(implicit session: play.api.mvc.Session)


@error(message: String) = {<div class="text-error">@message</div>} 
@none(message: String) = {<div class="text-warning">@message</div>} 
@resetURL = @{routes.IncidentBrowser.getIncidents(1,"created_at","","description",1)}
@maxPage = @{IncidentM.pageRangeMax(numberOfIncidents)}

@template("Incidents"){
	
	<!-- For time picker -->
 	<link href="@routes.Assets.at("stylesheets/jqueryUI.css")" rel="stylesheet" media="screen">
 	<link href="@routes.Assets.at("stylesheets/jqueryTimepicker.css")" rel="stylesheet" media="screen">

	<div class = "row">
		<div class ="span12">
			<h1>Incident Response Manager</h1>
		</div>
	</div>

	

	<div id = "page_current" data ="@params.page"></div>
	<div id = "sort_current" data="@params.sort"></div>
	<div id ="query_current" data="@params.query"></div>
	<div id ="queryCol_current" data ="@params.queryCol"></div>
	<div id ="queryOptions_current" data="@params.queryOptions"></div>


	<!-- Global error -->
	@if(!err.isEmpty){
		<div class="alert alert-error">  
  			<a href = @resetURL class="close" data-dismiss="alert">Reset</a>  
  			<strong>Error!</strong> @err.get  
		</div>

	}
	<!-- No results -->
	@if(numberOfIncidents == 0 ){
		<div class="alert alert-warning">  
  			<a href = @resetURL class="close" data-dismiss="alert">x</a>  
  			<strong>No results</strong> 
		</div>

	}

	<!-- query -->
	<div class = "row">
		<a href =@resetURL>Reset</a>

		<form class="form-inline">
		<!-- Multiple "query" forms. Only one visible at a time -->
		  <input id ="regularQuery" type="text" class="query" placeholder="Search...">
		  <input id ="timeQuery" type="text" class="query" placeholder="Time...">
		  <select id ="incidentTypeQuery" class="query">
		  	@for((value, display) <- IncidentM.incidentTypes){
		  		<option value="@value">@display</option>
		  	}
		  </select>
		  <select id ="statusQuery" class="query">
		  	@for((value, display) <- IncidentM.statusTypes){
		  		<option value="@value">@display</option>
		  	}
		  </select>
		  <select id ="issueTypeQuery" class="query">
		  	<!-- -1 will be interpreted as searching for null values -->
		  	<option value="-1">None</option>
		  	@for(issueType <- IssueTypeM.getIssueTypes){
		  		<option value="@issueType.id.get">@issueType.name</option>
		  	}
		  </select>

		<div id = "timeRadioGroup">
		  <label class="radio">
		 	<input id = "beforeRadio" type="radio" name="time" value="2">Before<br>
		  </label>
		  <label class="radio">
		 	<input id = "afterRadio"  type="radio" name="time" value="3">After<br>
		  </label>
		</div>

		  <select id ="queryCol">
		  	@for((value, display) <- IncidentM.columnMap){
		  		<option value ="@value">@display</option>
		  	}
		  </select>
		  <label  id = "wholewordgroup" class="checkbox">
		    <input id = "wholeword" type="checkbox"> Whole word
		  </label>
		  <a id ="search" class="btn"><i class="icon-search"></i></a>
		</form>

	</div>

	<!-- Table -->
	<div class = "row">
		<table class ="table table-striped">
			<thead>
				<tr>
					@for((value, display) <- IncidentM.columnMap){
						<th><a class = "sort" id = "@value">@display</a></th> 
					}
					<th>Controls</th>
				</tr>
			</thead>
			<tbody>
				@for(incident <- incidents){
					<tr>
						<td>@AnormJoda.formatDate(incident.created_at)</td>						
						<td>@AnormJoda.formatDate(incident.updated_at)</td>
						<td>@{AnormJoda.formatDate(incident.next_update_at) match {
							case Some(t) => t
							case None => none("--")
						}}</td>
						<td>@incident.title</td>
						<td>@incident.description</td>
						<td>@incident.incident_type</td>
						<td>@incident.status</td>

						<td>
						@{incident.issue_type_id match {
							case Some(i) => IssueTypeM.getIssueType(i) match {
								case Some(ish) => ish.name
								case None => error("Error")
							}
							case None => none("--")
						}
						}
						</td>
						<td>@incident.issue_id</td>
						
						
						<td>
						@UserM.getUser(incident.primary_responder) match {
							case Some(u) => {<a href="@routes.UserInfo.userPage(u.id.get)">@u.last_name</a>}
							case None => {none("--")}
						}
					
						</td>
						<td>
						@incident.respond_team_id match {
							case Some(i) => {
								@TeamM.getTeam(i) match {
									case Some(t) => {<a href="@routes.TeamInfo.teamPage(t.id.get)">@t.name</a>}
									case None => {@error("Error")}
								}
							}
							case None => {@none("--")}
							}
						</td>
						<td>@{AnormJoda.timeDiff(incident.created_at, incident.finished_at) match {
							case "Anachronism" => error("Anachronism")
							case d => d
							}
						}</td>

						<td>
							<a href = "@routes.IncidentView.incidentView(incident.id.getOrElse(-1))"><i class="icon-eye-open"></i></a>
							<a href = "@routes.IncidentUpdate.incidentUpdate(incident.id.getOrElse(-1))"><i class="icon-comment"></i></a>
							<a href = "@routes.IncidentEditor.incidentEdit(incident.id.getOrElse(-1))"><i class="icon-edit"></i></a>

						</td>

					</tr>
				}
			</tbody>
		</table>
	</div>


	<!-- Pagination -->
	<div class = "row">
		<ul class="pager">
			@if(params.page-1 < 1){
				<li class = "previous disabled">
			  		<a disabled>Previous</a></li>
			  	<li>
			}else{
				<li class = "previous">
			  		<a>Previous</a></li>
			  	<li>
			}

		  <li>Page @params.page/@maxPage</li>

		  	@if(params.page+1 > maxPage){
				<li class = "next disabled">
			  		<a disabled>Next</a></li>
			  	<li>
			}else{
				<li class = "next">
			  		<a>Next</a></li>
			  	<li>
			}
		</ul>
	</div>

	<script src="@routes.Assets.at("javascripts/jquery-1.9.0.min.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/jqueryUI.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/jqueryTimepicker.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/browser.js")" type ="text/javascript"></script>

}